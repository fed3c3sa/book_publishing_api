{% extends "base.html" %}

{% block additional_styles %}
    {% if theme == "children" %}
    /* Children's book theme - Playful and Bright */
    body {
        background-color: #fffcf0; /* Softer than floralwhite */
        /* Consider a very subtle background pattern if the renderer supports it:
           background-image: url('path/to/light_pattern.png');
        */
    }
    .book-title {
        font-family: 'Comic Sans MS', 'Chalkboard SE', 'Kristen ITC', cursive, sans-serif; /* Playful fonts */
        color: {{ title_color|default('#e74c3c') }}; /* Cheerful red */
    }
    .chapter-title {
        font-family: 'Comic Sans MS', 'Chalkboard SE', 'Kristen ITC', cursive, sans-serif; /* Consistent playful font */
        color: {{ chapter_title_color|default('#ff6b6b') }}; /* Bright pink/coral */
        border-bottom: none; /* Remove default border */
        padding-bottom: 0.5cm;
        position: relative; /* For pseudo-elements */
    }
    .chapter-title::after { /* Fun underline effect */
        content: '';
        display: block;
        width: 100px; /* Adjust width as needed */
        height: 4px;
        background-color: {{ chapter_title_color|default('#ff6b6b') }};
        border-radius: 2px;
        margin: 0.2cm auto 0 auto; /* Center the underline */
    }
    .decorative-border {
        border: {{ border_width|default(3) }}px dashed {{ border_color|default('#f7b731') }}; /* Playful orange dash */
        background-color: #fff9e6; /* Very light yellow */
        border-radius: {{ border_radius|default(15) }}px; /* More rounded */
        padding: 0.6cm;
    }
    .image {
        border: 3px solid #fdebd0; /* Light, playful border around images */
    }

    {% elif theme == "fantasy" %}
    /* Fantasy book theme - Magical and Whimsical */
    body {
        background-color: #f4f0f8; /* Light lavender tint */
    }
    .book-title {
        font-family: 'Luminari', 'Papyrus', 'Georgia Pro', serif; /* Whimsical/Fantasy fonts */
        color: {{ title_color|default('#5e3370') }}; /* Deep purple */
    }
    .chapter-title {
        font-family: 'Luminari', 'Papyrus', 'Georgia Pro', serif;
        color: {{ chapter_title_color|default('#4b0082') }}; /* Indigo */
        border-bottom: 2px dotted {{ chapter_title_color|default('#8a2be2') }}; /* Ornate dotted border */
        padding-bottom: 0.4cm;
        background: linear-gradient(to bottom, transparent 0%, #f8f4ff 100%); /* Subtle gradient background */
    }
    .decorative-border {
        border: {{ border_width|default(2) }}px double {{ border_color|default('#7d5bbe') }}; /* Elegant purple double border */
        background-color: #fdfaff; /* Very light purple */
        border-radius: {{ border_radius|default(8) }}px;
        box-shadow: 0 0 10px rgba(125, 91, 190, 0.1);
    }
    .image {
        box-shadow: 0 5px 10px rgba(75, 0, 130, 0.2); /* Purple-ish shadow */
    }

    {% elif theme == "adventure" %}
    /* Adventure book theme - Bold and Exciting */
    body {
        background-color: #fdfaf6; /* Off-white, slightly warm */
    }
    .book-title {
        font-family: 'Copperplate', 'Impact', 'Franklin Gothic Medium', sans-serif; /* Bold, adventurous fonts */
        color: {{ title_color|default('#c0392b') }}; /* Strong red */
    }
    .chapter-title {
        font-family: 'Copperplate', 'Impact', 'Franklin Gothic Medium', sans-serif;
        color: {{ chapter_title_color|default('#3a5a40') }}; /* Dark green */
        border-bottom: none;
        border-top: 3px solid {{ chapter_title_color|default('#588157') }};
        border-bottom: 3px solid {{ chapter_title_color|default('#588157') }};
        padding-top: 0.4cm;
        padding-bottom: 0.4cm;
        letter-spacing: 1px; /* Add some spacing for a bolder look */
    }
    .decorative-border {
        border: {{ border_width|default(4) }}px solid {{ border_color|default('#8c5e3c') }}; /* Earthy brown, thicker border */
        background-color: #f9f5eb; /* Light beige */
        border-radius: {{ border_radius|default(5) }}px; /* Less rounded, more rugged */
    }
    .image {
        border: 4px solid #d4a373; /* Earthy border for images */
    }
    {% endif %}

    /* Ensure specific font families are available or use web safe fonts */
    /* Example: @import url('https://fonts.googleapis.com/css2?family=YourKidFont&display=swap'); */
    /* body { font-family: 'YourKidFont', {{ font_family }}; } */

{% endblock %}

{% block content %}
    <div class="book-title">{{ title }}</div>

    {% if cover_image_path %}
    <img src="{{ cover_image_path }}" alt="Cover Image" class="cover-image">
    {% endif %}

    <div class="page-break"></div>

    {% for chapter in chapters %}
    <div class="chapter">
        <div class="chapter-title">{{ chapter.title }}</div>

        {% for content_block in chapter.content_blocks %}
            {% if content_block.type == 'text' %}
                <div class="paragraph{% if content_block.decorative_border %} decorative-border{% endif %}">
                    {{ content_block.content }}
                </div>
            {% elif content_block.type == 'image' %}
                <div class="image-container{% if content_block.float %} float-{{ content_block.float }}{% endif %}">
                    <img src="{{ content_block.path }}" alt="{{ content_block.alt_text }}" class="image">
                    {% if content_block.caption %}
                    <div class="image-caption">{{ content_block.caption }}</div>
                    {% endif %}
                </div>
                {% if content_block.float %}
                <div class="clearfix"></div>
                {% endif %}
            {% elif content_block.type == 'text_with_image' %}
                <div class="text-with-image-block clearfix"> <div class="image-container float-{{ content_block.image_position|default('right') }}">
                        <img src="{{ content_block.image_path }}" alt="{{ content_block.image_alt_text }}" class="image">
                        {% if content_block.image_caption %}
                        <div class="image-caption">{{ content_block.image_caption }}</div>
                        {% endif %}
                    </div>
                    <div class="paragraph">
                        {{ content_block.text_content }}
                    </div>
                </div>
            {% endif %}
        {% endfor %}
    </div>
    {% endfor %}
{% endblock %}