{% extends "base.html" %}

{% block additional_styles %}
    body {
        /* {{ background_color }} is set in base.html and should be controlled by your variable */
    }

    /* General style to make the cover image square and larger */
    .cover-image {
        display: block; /* Ensures the image is a block element, allowing for auto margins */
        width: 450px;   /* Increased width for a larger cover image. Adjust as needed. */
        height: 450px;  /* Increased height to match width for a square. */
                        /* Alternatively, if using width and aspect-ratio:
                           width: 450px;
                           aspect-ratio: 1 / 1; */
        object-fit: cover;   /* Ensures the image covers the area, cropping if necessary */
        margin-left: auto;   /* Centers the image horizontally */
        margin-right: auto;  /* Centers the image horizontally */
        margin-top: 0.5cm;   /* Adds some space above the image */
        margin-bottom: 1.5cm;  /* Increased bottom margin for better spacing */
    }

    /* General style for paragraphs to ensure text is justified */
    .paragraph {
        text-align: justify;
        margin-bottom: 0.5cm; /* Default bottom margin for paragraphs, adjust as needed */
        /* Add other general paragraph styling here if needed */
    }


    {% if theme == "children" %}
    /* Children's book theme - Playful and Bright */
    .book-title {
        font-family: 'Comic Sans MS', 'Chalkboard SE', 'Kristen ITC', cursive, sans-serif;
        color: {{ title_color|default('#e74c3c') }};
    }
    .chapter-title {
        font-family: 'Comic Sans MS', 'Chalkboard SE', 'Kristen ITC', cursive, sans-serif;
        color: {{ chapter_title_color|default('#ff6b6b') }};
        border-bottom: 3px dotted {{ chapter_title_color|default('#ff6b6b') }};
        padding-bottom: 0.4cm;
        margin-bottom: 1.2cm;
    }
    .chapter-title::before, .chapter-title::after { /* Sparkles */
        content: 'âœ§';
        font-size: 0.8em;
        color: {{ chapter_title_color|default('#ff9a00') }};
        padding: 0 5px;
    }
    .decorative-border {
        border: {{ border_width|default(3) }}px dashed {{ border_color|default('#f7b731') }};
        background-color: transparent;
        border-radius: {{ border_radius|default(15) }}px;
        padding: 0.5cm;
        margin-bottom: 0.5cm; /* Ensure decorative borders also have consistent spacing */
    }
    .image, .cover-image { /* Cool border for children's theme images */
        border: 5px solid {{ border_color|default('#ffdd77') }}; /* Cheerful yellow border */
        padding: 4px; /* Padding creates an inner "matting" effect */
        background-color: {{ background_color|default('#FFFFFF') }}; /* Image sits on page background, padding shows border color */
        border-radius: 12px;
        box-shadow: 0 4px 8px rgba(0,0,0,0.15);
    }

    {% elif theme == "fantasy" %}
    /* Fantasy book theme - Magical and Whimsical */
    .book-title {
        font-family: 'Luminari', 'Papyrus', 'Times New Roman', serif;
        color: {{ title_color|default('#5D3A9B') }};
    }
    .chapter-title {
        font-family: 'Luminari', 'Papyrus', 'Times New Roman', serif;
        color: {{ chapter_title_color|default('#4b0082') }};
        border-top: 1px solid {{ chapter_title_color|default('#8a2be2') }};
        border-bottom: 1px solid {{ chapter_title_color|default('#8a2be2') }};
        padding-top: 0.3cm;
        padding-bottom: 0.3cm;
        letter-spacing: 0.5px;
        margin-bottom: 1.2cm;
    }
    .chapter-title::before { /* Scroll Icon */
        content: "ðŸ“œ ";
        font-size: 0.7em;
        opacity: 0.7;
        padding-right: 5px;
    }
    .decorative-border {
        border: {{ border_width|default(2) }}px double {{ border_color|default('#7d5bbe') }};
        background-color: transparent;
        border-radius: {{ border_radius|default(8) }}px;
        box-shadow: 0 0 8px rgba(125, 91, 190, 0.2);
        padding: 0.5cm;
        margin-bottom: 0.5cm;
    }
    .image, .cover-image { /* Cool border for fantasy theme images */
        border: 3px groove {{ border_color|default('#ab87ff') }}; /* Grooved border for a subtle 3D effect */
        padding: 5px;
        background-color: {{ background_color|default('#FFFFFF') }};
        border-radius: 10px;
        box-shadow: 0 0 10px 2px {{ chapter_title_color|default('rgba(138, 43, 226, 0.4)') }}; /* Magical glow */
    }

    {% elif theme == "adventure" %}
    /* Adventure book theme - Bold and Exciting */
    .book-title {
        font-family: 'Copperplate', 'Impact', 'Arial Black', sans-serif;
        color: {{ title_color|default('#b33939') }};
    }
    .chapter-title {
        font-family: 'Copperplate', 'Impact', 'Arial Black', sans-serif;
        color: {{ chapter_title_color|default('#2c3e50') }};
        border-bottom: 4px solid {{ chapter_title_color|default('#784F32') }}; /* Darker Brown */
        text-transform: uppercase;
        letter-spacing: 1.5px;
        margin-bottom: 1.2cm;
    }
    .chapter-title::after { /* Compass Icon */
        content: " ðŸ§­";
        font-size: 0.7em;
        opacity: 0.8;
        padding-left: 5px;
    }
    .decorative-border {
        border: {{ border_width|default(4) }}px solid {{ border_color|default('#8c5e3c') }};
        background-color: transparent;
        border-radius: {{ border_radius|default(4) }}px;
        padding: 0.5cm;
        margin-bottom: 0.5cm;
    }
    .image, .cover-image { /* Cool border for adventure theme images */
        border: 6px ridge {{ border_color|default('#8B4513') }}; /* SaddleBrown - like a heavier wooden frame */
        padding: 3px;
        background-color: {{ background_color|default('#FFFFFF') }};
        border-radius: 5px;
        box-shadow: 2px 2px 7px rgba(0,0,0,0.25);
    }

    {% endif %}
{% endblock %}

{% block content %}
    <div class="title-page-container">
        <div class="book-title">{{ title }}</div>
        {% if cover_image_path %}
        <img src="{{ cover_image_path }}" alt="Cover Image" class="cover-image">
        {% endif %}
    </div>

    <div class="page-break"></div>

    {% for chapter in chapters %}
    <div class="chapter">
        <div class="chapter-title">{{ chapter.title }}</div>

        {% for content_block in chapter.content_blocks %}
            {% if content_block.type == 'text' %}
                <div class="paragraph{% if content_block.decorative_border %} decorative-border{% endif %}">
                    {{ content_block.content }}
                </div>
            {% elif content_block.type == 'image' %}
                <div class="image-container{% if content_block.float %} float-{{ content_block.float }}{% endif %}">
                    <img src="{{ content_block.path }}" alt="{{ content_block.alt_text }}" class="image">
                    {% if content_block.caption %}
                    <div class="image-caption">{{ content_block.caption }}</div>
                    {% endif %}
                </div>
                {% if content_block.float %}
                <div class="clearfix"></div>
                {% endif %}
            {% elif content_block.type == 'text_with_image' %}
                <div class="text-with-image-block clearfix">
                    <div class="image-container float-{{ content_block.image_position|default('right') }}">
                        <img src="{{ content_block.image_path }}" alt="{{ content_block.image_alt_text }}" class="image">
                        {% if content_block.image_caption %}
                        <div class="image-caption">{{ content_block.image_caption }}</div>
                        {% endif %}
                    </div>
                    <div class="paragraph">
                        {{ content_block.text_content }}
                    </div>
                </div>
            {% endif %}
        {% endfor %}
    </div>
    {% endfor %}
{% endblock %}