{% extends "base.html" %}

{% block additional_styles %}
    body {
        /* {{ background_color }} is set in base.html and should be controlled by your variable */
        /* For CSS hyphenation to work correctly, ensure your HTML has the correct lang attribute.
           For Italian, you would typically have <html lang="it"> or <body lang="it"> in your base.html. */
    }

    /* General style to make the cover image square and larger */
    .cover-image {
        display: block;
        width: 600px;
        height: 600px;
        object-fit: cover;
        margin-left: auto;
        margin-right: auto;
        margin-top: 2cm;
    }

    /* Title page container to stack title and image properly */
    .title-page-container {
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: flex-start;
        height: 100vh;
        padding-top: 3cm;
        box-sizing: border-box;
    }

    /* Book title positioning */
    .book-title {
        text-align: center;
        margin-bottom: 1cm;
        z-index: 10;
        text-transform: uppercase;
    }

    /* General style for paragraphs to ensure text is justified and reduce spacing issues */
    .paragraph {
        text-align: justify;
        margin-bottom: 0.4cm; /* Reduced from 0.5cm, adjust as needed */
        -webkit-hyphens: auto; /* Safari, Chrome */
        -moz-hyphens: auto;    /* Firefox */
        -ms-hyphens: auto;     /* IE, Edge */
        hyphens: auto;         /* Standard */
        font-size: 24px;
        text-transform: uppercase;
        /* Line height can also affect perceived spacing, adjust if necessary:
           line-height: 1.6; (example) */
    }

    /* Make regular images bigger */
    .image {
        width: 600px;
        height: 600px;
        object-fit: cover;
    }


    {% if theme == "children" %}
    /* Children's book theme - Playful and Bright */
    .book-title {
        font-family: 'Comic Sans MS', 'Chalkboard SE', 'Kristen ITC', cursive, sans-serif;
        color: {{ title_color|default('#e74c3c') }};
        text-transform: uppercase;
    }
    .chapter-title {
        font-family: 'Comic Sans MS', 'Chalkboard SE', 'Kristen ITC', cursive, sans-serif;
        color: {{ chapter_title_color|default('#ff6b6b') }};
        border-bottom: 3px dotted {{ chapter_title_color|default('#ff6b6b') }};
        padding-bottom: 0.3cm; /* Reduced from 0.4cm */
        margin-bottom: 1cm;    /* Reduced from 1.2cm */
    }
    .chapter-title::before, .chapter-title::after { /* Sparkles */
        content: 'âœ§';
        font-size: 0.8em;
        color: {{ chapter_title_color|default('#ff9a00') }};
        padding: 0 5px;
    }
    .decorative-border {
        border: {{ border_width|default(3) }}px dashed {{ border_color|default('#f7b731') }};
        background-color: transparent;
        border-radius: {{ border_radius|default(15) }}px;
        padding: 0.4cm;        /* Reduced from 0.5cm */
        margin-bottom: 0.4cm; /* Reduced from 0.5cm */
    }
    .image, .cover-image { /* Cool border for children's theme images */
        border: 5px solid {{ border_color|default('#ffdd77') }};
        padding: 4px;
        background-color: {{ background_color|default('#FFFFFF') }};
        border-radius: 12px;
        box-shadow: 0 4px 8px rgba(0,0,0,0.15);
    }

    {% elif theme == "fantasy" %}
    /* Fantasy book theme - Magical and Whimsical */
    .book-title {
        font-family: 'Luminari', 'Papyrus', 'Times New Roman', serif;
        color: {{ title_color|default('#5D3A9B') }};
        text-transform: uppercase;
    }
    .chapter-title {
        font-family: 'Luminari', 'Papyrus', 'Times New Roman', serif;
        color: {{ chapter_title_color|default('#4b0082') }};
        border-top: 1px solid {{ chapter_title_color|default('#8a2be2') }};
        border-bottom: 1px solid {{ chapter_title_color|default('#8a2be2') }};
        padding-top: 0.2cm;    /* Reduced from 0.3cm */
        padding-bottom: 0.2cm; /* Reduced from 0.3cm */
        letter-spacing: 0.5px;
        margin-bottom: 1cm;    /* Reduced from 1.2cm */
    }
    .chapter-title::before { /* Scroll Icon */
        content: "ðŸ“œ ";
        font-size: 0.7em;
        opacity: 0.7;
        padding-right: 5px;
    }
    .decorative-border {
        border: {{ border_width|default(2) }}px double {{ border_color|default('#7d5bbe') }};
        background-color: transparent;
        border-radius: {{ border_radius|default(8) }}px;
        box-shadow: 0 0 8px rgba(125, 91, 190, 0.2);
        padding: 0.4cm;        /* Reduced from 0.5cm */
        margin-bottom: 0.4cm; /* Reduced from 0.5cm */
    }
    .image, .cover-image { /* Cool border for fantasy theme images */
        border: 3px groove {{ border_color|default('#ab87ff') }};
        padding: 5px;
        background-color: {{ background_color|default('#FFFFFF') }};
        border-radius: 10px;
        box-shadow: 0 0 10px 2px {{ chapter_title_color|default('rgba(138, 43, 226, 0.4)') }};
    }

    {% elif theme == "adventure" %}
    /* Adventure book theme - Bold and Exciting */
    .book-title {
        font-family: 'Copperplate', 'Impact', 'Arial Black', sans-serif;
        color: {{ title_color|default('#b33939') }};
        text-transform: uppercase;
    }
    .chapter-title {
        font-family: 'Copperplate', 'Impact', 'Arial Black', sans-serif;
        color: {{ chapter_title_color|default('#2c3e50') }};
        border-bottom: 4px solid {{ chapter_title_color|default('#784F32') }};
        text-transform: uppercase;
        letter-spacing: 1.5px;
        margin-bottom: 1cm;    /* Reduced from 1.2cm */
    }
    .chapter-title::after { /* Compass Icon */
        content: " ðŸ§­";
        font-size: 0.7em;
        opacity: 0.8;
        padding-left: 5px;
    }
    .decorative-border {
        border: {{ border_width|default(4) }}px solid {{ border_color|default('#8c5e3c') }};
        background-color: transparent;
        border-radius: {{ border_radius|default(4) }}px;
        padding: 0.4cm;        /* Reduced from 0.5cm */
        margin-bottom: 0.4cm; /* Reduced from 0.5cm */
    }
    .image, .cover-image { /* Cool border for adventure theme images */
        border: 6px ridge {{ border_color|default('#8B4513') }};
        padding: 3px;
        background-color: {{ background_color|default('#FFFFFF') }};
        border-radius: 5px;
        box-shadow: 2px 2px 7px rgba(0,0,0,0.25);
    }

    {% endif %}
{% endblock %}

{% block content %}
    <div class="title-page-container">
        <div class="book-title">{{ title }}</div>
        {% if cover_image_path %}
        <img src="{{ cover_image_path }}" alt="Cover Image" class="cover-image">
        {% endif %}
    </div>

    <div class="page-break"></div>

    {% for chapter in chapters %}
    <div class="chapter">
        <div class="chapter-title">{{ chapter.title }}</div>

        {% for content_block in chapter.content_blocks %}
            {% if content_block.type == 'text' %}
                <div class="paragraph{% if content_block.decorative_border %} decorative-border{% endif %}">
                    {{ content_block.content }}
                </div>
            {% elif content_block.type == 'image' %}
                <div class="image-container{% if content_block.float %} float-{{ content_block.float }}{% endif %}">
                    <img src="{{ content_block.path }}" alt="{{ content_block.alt_text }}" class="image">
                    {% if content_block.caption %}
                    <div class="image-caption">{{ content_block.caption }}</div>
                    {% endif %}
                </div>
                {% if content_block.float %}
                <div class="clearfix"></div>
                {% endif %}
            {% elif content_block.type == 'text_with_image' %}
                <div class="text-with-image-block clearfix">
                    <div class="image-container float-{{ content_block.image_position|default('right') }}">
                        <img src="{{ content_block.image_path }}" alt="{{ content_block.image_alt_text }}" class="image">
                        {% if content_block.image_caption %}
                        <div class="image-caption">{{ content_block.image_caption }}</div>
                        {% endif %}
                    </div>
                    <div class="paragraph">
                        {{ content_block.text_content }}
                    </div>
                </div>
            {% endif %}
        {% endfor %}
    </div>
    {% endfor %}
{% endblock %}